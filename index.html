<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>快樂芒果｜被打的芒果（幸福教養）</title>

  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="快樂芒果" />
  <meta name="theme-color" content="#fbbf24" />

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');

    :root{
      --indigo:#312e81;
      --orange:#f59e0b;
      --orange2:#fbbf24;
      --bg:#fffbeb;
    }

    body{
      font-family:'Noto Sans TC',sans-serif;
      background:var(--bg);
      -webkit-tap-highlight-color:transparent;
      color:var(--indigo);
    }

    .mango-gradient{ background:linear-gradient(135deg,var(--orange2) 0%,var(--orange) 100%); }
    .glass-card{ background:rgba(255,255,255,.92); backdrop-filter:blur(10px); border:1px solid rgba(251,191,36,.18); }
    .tab-active{ color:var(--orange); border-bottom:3px solid var(--orange); }

    .page-content{ display:none; }
    .page-content.active{ display:block; }

    .fade-in{ animation:fadeIn .35s ease-out forwards; }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

    ::-webkit-scrollbar{ width:4px; }
    ::-webkit-scrollbar-thumb{ background:#fde68a; border-radius:10px; }

    @media (prefers-reduced-motion: reduce){
      .fade-in{ animation:none !important; }
      *{ scroll-behavior:auto !important; }
    }
  </style>
</head>

<body class="pb-24">

  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md px-4 py-3 flex items-center justify-between shadow-sm">
    <div class="flex items-center space-x-2">
      <div class="w-10 h-10 mango-gradient rounded-xl flex items-center justify-center text-white text-xl shadow-lg" aria-hidden="true">
        <i class="fas fa-hand-holding-heart"></i>
      </div>
      <div>
        <h1 class="text-lg font-black tracking-tight text-indigo-900">快樂芒果</h1>
        <p class="text-[9px] text-orange-500 font-black uppercase tracking-tighter">被打的芒果｜幸福教養</p>
      </div>
    </div>

    <button data-page="sos" class="bg-red-500 text-white px-3 py-1.5 rounded-full shadow-lg flex items-center space-x-1 active:scale-90 transition-all" aria-label="啟動情緒急救">
      <i class="fas fa-bolt text-xs" aria-hidden="true"></i>
      <span class="text-[11px] font-black">情緒急救</span>
    </button>
  </header>

  <!-- Main -->
  <main class="max-w-md mx-auto p-5">

    <!-- HOME -->
    <div id="page-home" class="page-content active space-y-7">

      <!-- 0) 金句雙問 -->
      <section class="space-y-3">
        <div class="flex items-center space-x-2 px-1">
          <div class="bg-indigo-600 w-1.5 h-5 rounded-full" aria-hidden="true"></div>
          <h2 class="text-md font-bold text-indigo-900">先問兩句｜把心站穩</h2>
        </div>

        <div class="bg-white p-6 rounded-[2rem] border-2 border-indigo-100 shadow-sm">
          <div class="flex items-start gap-3">
            <div class="w-10 h-10 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center text-lg shrink-0" aria-hidden="true">
              <i class="fas fa-question"></i>
            </div>
            <div class="space-y-3">
              <p class="text-[12px] text-indigo-800 font-black leading-relaxed">
                當孩子學不會時，您的憤怒是來自於孩子的表現，還是來自於您對「失敗」的焦慮？
              </p>
              <p class="text-[12px] text-indigo-800 font-black leading-relaxed">
                我們想要孩子學會的是「知識內容」，還是面對困難時「恐懼的反應」？
              </p>

              <button class="mt-2 text-indigo-700 font-black underline text-xs"
                      data-copy="當孩子學不會時，您的憤怒是來自於孩子的表現，還是來自於您對「失敗」的焦慮？\n我們想要孩子學會的是「知識內容」，還是面對困難時「恐懼的反應」？">
                一鍵複製這段（貼文/留言置頂很方便）
              </button>
            </div>
          </div>

          <!-- ✅ 新增：我今天只做一件事 -->
          <div class="mt-5 p-4 bg-orange-50/60 rounded-2xl border border-orange-100">
            <div class="flex items-center justify-between gap-2">
              <p class="text-[12px] font-black text-orange-700">
                我今天只做一件事：
              </p>
              <span class="text-[10px] font-black text-indigo-700 bg-white/70 px-2 py-1 rounded-full border border-orange-100">
                點一下就複製
              </span>
            </div>

            <div class="mt-3 grid grid-cols-3 gap-2">
              <button class="bg-white border border-orange-200 text-orange-700 py-3 rounded-2xl font-black text-[11px] shadow-sm active:scale-95 transition"
                      data-copy="好，我先把音量降一半。我們慢慢來。">
                先降音量
              </button>

              <button class="bg-white border border-orange-200 text-orange-700 py-3 rounded-2xl font-black text-[11px] shadow-sm active:scale-95 transition"
                      data-copy="先不急，我們先呼吸三次：吸四、停二、吐六。">
                先呼吸
              </button>

              <button class="bg-white border border-orange-200 text-orange-700 py-3 rounded-2xl font-black text-[11px] shadow-sm active:scale-95 transition"
                      data-copy="我們把任務切小：你先說『芒』就好，說完我跟你擊掌。">
                先切小
              </button>
            </div>

            <p class="mt-3 text-[11px] text-indigo-700 font-medium leading-relaxed">
              先救「恐懼反應」，再救「知識內容」。今天只做一件事，也算贏。
            </p>
          </div>
        </div>
      </section>

      <!-- 1) 說明框（取代找對策框） -->
      <section class="space-y-4">
        <div class="flex items-center space-x-2 px-1">
          <div class="bg-yellow-400 w-1.5 h-5 rounded-full" aria-hidden="true"></div>
          <h2 class="text-md font-bold text-indigo-900">說明框｜被打的芒果</h2>
        </div>

        <div class="glass-card p-6 rounded-[2rem] shadow-xl border-orange-100">
          <p class="text-[12px] text-indigo-700 font-black mb-3">哈囉，我是小天使笑長。</p>

          <p class="text-[12px] text-indigo-700 leading-relaxed font-medium">
            你聽過「被打的芒果」嗎？不是什麼新品種水果，
            而是一顆被大人情緒硬生生打歪了的芒果。
            今天我們要把它，從「恐懼的冰箱」裡救出來。
          </p>

          <div class="mt-5 grid grid-cols-3 gap-2">
            <button data-page="sos" class="bg-red-500 text-white py-3 rounded-2xl font-black text-[11px] shadow-md active:scale-95 transition">
              90秒急救
            </button>
            <button data-page="dojo" class="bg-indigo-900 text-white py-3 rounded-2xl font-black text-[11px] shadow-md active:scale-95 transition">
              看說玩用
            </button>
            <button data-page="repair" class="bg-white border border-orange-200 text-orange-600 py-3 rounded-2xl font-black text-[11px] shadow-sm active:scale-95 transition">
              立刻修復
            </button>
          </div>

          <div class="mt-4 flex items-center justify-between gap-2">
            <button id="btnWatchVideo" class="flex-1 mango-gradient text-white py-3.5 rounded-2xl font-black text-[12px] shadow-lg active:scale-95 transition">
              <i class="fas fa-play-circle mr-2" aria-hidden="true"></i> 觀看影片：被打的芒果
            </button>
            <button id="btnOpenConcept" class="w-12 h-12 bg-white border border-indigo-100 text-indigo-700 rounded-2xl shadow-sm flex items-center justify-center active:scale-95 transition" aria-label="前往概念館官網">
              <i class="fas fa-university" aria-hidden="true"></i>
            </button>
          </div>

          <div class="mt-4 p-4 bg-orange-50/60 rounded-2xl border border-orange-100">
            <p class="text-[11px] font-black text-orange-700 mb-1">笑長提醒你：</p>
            <p class="text-[12px] text-indigo-700 font-medium leading-relaxed">
              當我們太想孩子「趕快學會、馬上做到」，最先被打壞的，
              往往不是知識，而是學習的快樂，還有親子的信任。
            </p>
          </div>
        </div>
      </section>

      <!-- 2) 三句陪伴話（可複製） -->
      <section class="space-y-3">
        <div class="flex items-center space-x-2 px-1">
          <div class="bg-indigo-600 w-1.5 h-5 rounded-full" aria-hidden="true"></div>
          <h2 class="text-md font-bold text-indigo-900">三句就夠｜先救回連結</h2>
        </div>

        <div class="glass-card p-5 rounded-[2rem] shadow-lg">
          <div class="space-y-3">
            <button class="w-full text-left p-4 rounded-2xl bg-white border border-indigo-50 shadow-sm active:scale-[0.99] transition"
                    data-copy="好，我先停一下。我的音量降一半。">
              <p class="text-[12px] font-black text-indigo-900">① 停（先救大人）</p>
              <p class="text-[12px] text-indigo-700 font-medium mt-1">「好，我先停一下。我的音量降一半。」</p>
              <p class="text-[10px] text-orange-600 font-black mt-2">點我一鍵複製</p>
            </button>

            <button class="w-full text-left p-4 rounded-2xl bg-white border border-indigo-50 shadow-sm active:scale-[0.99] transition"
                    data-copy="你看起來卡住又著急，肚子也緊緊的，對嗎？">
              <p class="text-[12px] font-black text-indigo-900">② 名（先保住孩子的心）</p>
              <p class="text-[12px] text-indigo-700 font-medium mt-1">「你看起來卡住又著急，肚子也緊緊的，對嗎？」</p>
              <p class="text-[10px] text-orange-600 font-black mt-2">點我一鍵複製</p>
            </button>

            <button class="w-full text-left p-4 rounded-2xl bg-white border border-indigo-50 shadow-sm active:scale-[0.99] transition"
                    data-copy="我們先只說『芒』，說完就擊掌。">
              <p class="text-[12px] font-black text-indigo-900">③ 換（把成功拆很小）</p>
              <p class="text-[12px] text-indigo-700 font-medium mt-1">「我們先只說『芒』，說完就擊掌。」</p>
              <p class="text-[10px] text-orange-600 font-black mt-2">點我一鍵複製</p>
            </button>
          </div>
        </div>
      </section>

      <!-- 3) 芒果和平條約（可複製） -->
      <section class="mango-gradient p-7 rounded-[2.5rem] text-white shadow-2xl">
        <h3 class="text-xl font-black mb-4 tracking-tight">芒果和平條約</h3>
        <div class="space-y-2 text-[12px] font-bold">
          <p><i class="fas fa-heart mr-2 text-[10px]" aria-hidden="true"></i> 我們不打人，也不打水果。</p>
          <p><i class="fas fa-cloud mr-2 text-[10px]" aria-hidden="true"></i> 卡關時，我們先呼吸三次。</p>
          <p><i class="fas fa-hand-sparkles mr-2 text-[10px]" aria-hidden="true"></i> 用選擇句：休息／抱抱／換回合。</p>
          <p><i class="fas fa-star mr-2 text-[10px]" aria-hidden="true"></i> 完成一小步，就擊掌。</p>
        </div>

        <button id="btnCopyTreaty" class="w-full mt-6 bg-white text-orange-600 py-3 rounded-2xl font-black text-sm active:scale-95 transition">
          一鍵複製和平條約（貼牆版）
        </button>
      </section>
    </div>

    <!-- DOJO -->
    <div id="page-dojo" class="page-content space-y-6">
      <div class="flex items-center space-x-2 px-1">
        <div class="bg-indigo-600 w-1.5 h-5 rounded-full" aria-hidden="true"></div>
        <h2 class="text-md font-bold text-indigo-900">把學習變簡單｜看・說・玩・用</h2>
      </div>

      <section class="grid grid-cols-2 gap-3">
        <button class="glass-card p-4 rounded-[1.8rem] text-left active:scale-[0.99] transition"
                data-copy="我們先『看』十秒：它黃黃的、香香的。">
          <div class="w-9 h-9 bg-blue-100 text-blue-500 rounded-xl flex items-center justify-center mb-2" aria-hidden="true">
            <i class="fas fa-eye text-sm"></i>
          </div>
          <p class="font-black text-indigo-900 text-sm">看</p>
          <p class="text-[10px] text-indigo-600 font-bold mt-1">10秒說兩個特徵</p>
          <p class="text-[10px] text-orange-600 font-black mt-2">點我複製一句</p>
        </button>

        <button class="glass-card p-4 rounded-[1.8rem] text-left active:scale-[0.99] transition"
                data-copy="我先分解：『芒——果——』你跟一個音也算成功。">
          <div class="w-9 h-9 bg-green-100 text-green-500 rounded-xl flex items-center justify-center mb-2" aria-hidden="true">
            <i class="fas fa-comment text-sm"></i>
          </div>
          <p class="font-black text-indigo-900 text-sm">說</p>
          <p class="text-[10px] text-indigo-600 font-bold mt-1">分解音節，一音也算成功</p>
          <p class="text-[10px] text-orange-600 font-black mt-2">點我複製一句</p>
        </button>

        <button class="glass-card p-4 rounded-[1.8rem] text-left active:scale-[0.99] transition"
                data-copy="我們來『玩』：找同色、或用積木排出芒果形狀。">
          <div class="w-9 h-9 bg-purple-100 text-purple-500 rounded-xl flex items-center justify-center mb-2" aria-hidden="true">
            <i class="fas fa-gamepad text-sm"></i>
          </div>
          <p class="font-black text-indigo-900 text-sm">玩</p>
          <p class="text-[10px] text-indigo-600 font-bold mt-1">找同色／積木排芒果</p>
          <p class="text-[10px] text-orange-600 font-black mt-2">點我複製一句</p>
        </button>

        <button class="glass-card p-4 rounded-[1.8rem] text-left active:scale-[0.99] transition"
                data-copy="最後用生活收尾：摸真的芒果、聞一聞，我們就下課。">
          <div class="w-9 h-9 bg-orange-100 text-orange-500 rounded-xl flex items-center justify-center mb-2" aria-hidden="true">
            <i class="fas fa-utensils text-sm"></i>
          </div>
          <p class="font-black text-indigo-900 text-sm">用</p>
          <p class="text-[10px] text-indigo-600 font-bold mt-1">摸真的芒果、聞一聞</p>
          <p class="text-[10px] text-orange-600 font-black mt-2">點我複製一句</p>
        </button>
      </section>
    </div>

    <!-- VIDEO -->
    <div id="page-video" class="page-content space-y-6">
      <div class="flex items-center space-x-2 px-1">
        <div class="bg-indigo-600 w-1.5 h-5 rounded-full" aria-hidden="true"></div>
        <h2 class="text-md font-bold text-indigo-900">笑長智慧影片館｜被打的芒果</h2>
      </div>

      <div class="glass-card overflow-hidden rounded-[2.5rem] shadow-lg border-2 border-orange-50">
        <div class="aspect-video w-full bg-black">
          <iframe class="w-full h-full" loading="lazy"
            id="videoIframe"
            src=""
            title="被打的芒果：幸福教養"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowfullscreen></iframe>
        </div>

        <div class="p-6 space-y-3">
          <div class="flex justify-between items-start gap-3">
            <h3 class="font-black text-indigo-900 text-lg leading-tight">＜被打的芒果＞<br />90 秒救回專注力</h3>
            <span class="shrink-0 bg-orange-100 text-orange-600 text-[10px] px-2 py-1 rounded-full font-bold italic">幸福教養</span>
          </div>

          <p class="text-[12px] text-indigo-700 leading-relaxed font-medium">
            孩子不是不專心，是前額葉被壓住了。先降溫、先連結，學習才回來。
          </p>

          <div class="flex gap-2 pt-2 flex-wrap">
            <span class="text-[10px] bg-red-50 text-red-500 px-3 py-1 rounded-lg font-bold border border-red-100">停看呼名換動</span>
            <span class="text-[10px] bg-indigo-50 text-indigo-500 px-3 py-1 rounded-lg font-bold border border-indigo-100">塑形小步走</span>
          </div>

          <button id="btnOpenYoutube" class="w-full mt-2 bg-white border border-indigo-100 text-indigo-700 py-3 rounded-2xl font-black text-sm shadow-sm active:scale-95 transition">
            <i class="fas fa-arrow-up-right-from-square mr-2" aria-hidden="true"></i> 用 YouTube 開啟（比較穩）
          </button>
        </div>
      </div>

      <div class="bg-white p-6 rounded-[2.5rem] border-2 border-indigo-100 text-center space-y-4 shadow-sm">
        <div class="w-16 h-16 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto text-3xl" aria-hidden="true">
          <i class="fas fa-university"></i>
        </div>
        <h3 class="font-black text-indigo-900">幸福教養概念館</h3>
        <p class="text-[11px] text-indigo-600 font-medium px-4 leading-relaxed">
          想看更多系統化教學（心靈感悟＋腦科學原稿）？都在概念館官網。
        </p>

        <button id="btnOpenConcept2"
          class="w-full bg-indigo-600 text-white py-3.5 rounded-2xl font-black text-sm shadow-md flex items-center justify-center active:scale-95 transition">
          <i class="fas fa-external-link-alt mr-2 text-xs" aria-hidden="true"></i> 進入概念館官網
        </button>
      </div>
    </div>

    <!-- REPAIR -->
    <div id="page-repair" class="page-content space-y-6">
      <div class="flex items-center space-x-2 px-1">
        <div class="bg-orange-400 w-1.5 h-5 rounded-full" aria-hidden="true"></div>
        <h2 class="text-md font-bold text-indigo-900">快樂芒果回饋單｜也請把我們變更好</h2>
      </div>

      <div class="mango-gradient p-8 rounded-[3rem] text-white text-center space-y-4 shadow-2xl relative overflow-hidden">
        <div class="absolute -top-4 -right-4 w-24 h-24 bg-white/10 rounded-full" aria-hidden="true"></div>
        <i class="fas fa-clipboard-check text-4xl" aria-hidden="true"></i>
        <h3 class="font-black text-xl">回饋單（正式連結）</h3>
        <p class="text-[12px] font-bold opacity-90 px-2 leading-relaxed">
          你的實踐心得，是笑長最珍貴的禮物。讓我們一起把工具做得更好用。
        </p>
        <button id="btnOpenForm"
          class="w-full bg-indigo-900 text-white py-4 rounded-[1.5rem] font-black text-sm shadow-xl active:scale-95 transition-all">
          打開：快樂芒果回饋單
        </button>
      </div>
    </div>

    <!-- SOS -->
    <div id="page-sos" class="page-content space-y-4">
      <div class="bg-red-50 p-7 rounded-[2.5rem] border-2 border-red-100 shadow-2xl">
        <div class="flex justify-between items-center mb-6">
          <h3 class="font-black text-red-600 flex items-center">
            <i class="fas fa-lungs mr-3 text-xl" aria-hidden="true"></i> 90 秒急救：停看呼名換動
          </h3>
          <button data-page="home" class="text-red-300" aria-label="關閉急救">
            <i class="fas fa-times-circle text-2xl" aria-hidden="true"></i>
          </button>
        </div>

        <div class="p-4 bg-white rounded-2xl border border-red-100 mb-4">
          <p class="text-[12px] text-indigo-700 font-medium leading-relaxed">
            先把「恐懼反應」降下來，前額葉才會回線；前額葉回線了，學習才回來。
          </p>
        </div>

        <div id="sosSteps" class="space-y-3"></div>

        <button id="sosBtn" class="w-full mt-8 bg-red-500 text-white py-4 rounded-2xl font-black text-sm shadow-lg active:scale-95 transition">
          好，下一小步
        </button>

        <button class="w-full mt-3 bg-white border border-red-200 text-red-600 py-3 rounded-2xl font-black text-sm shadow-sm active:scale-95 transition"
                data-copy="停——先停下追問，音量降到一半。看——看孩子，也看自己。呼——吸4停2吐6。名——幫情緒命名。換——任務切小先說『芒』。動——嘴巴張大一起發『芒』。">
          一鍵複製：整套急救口訣
        </button>
      </div>
    </div>

  </main>

  <!-- Footer Tab Bar -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-orange-100 flex justify-around items-center py-4 z-50 rounded-t-[2rem] shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
    <button data-page="home" id="tab-home" class="flex flex-col items-center tab-active transition-all">
      <i class="fas fa-home text-lg" aria-hidden="true"></i>
      <span class="text-[10px] font-black mt-1">說明框</span>
    </button>

    <button data-page="dojo" id="tab-dojo" class="flex flex-col items-center text-indigo-300 transition-all">
      <i class="fas fa-cubes text-lg" aria-hidden="true"></i>
      <span class="text-[10px] font-black mt-1">看說玩用</span>
    </button>

    <button data-page="video" id="tab-video" class="flex flex-col items-center text-indigo-300 transition-all">
      <i class="fas fa-play-circle text-lg" aria-hidden="true"></i>
      <span class="text-[10px] font-black mt-1">影片</span>
    </button>

    <button data-page="repair" id="tab-repair" class="flex flex-col items-center text-indigo-300 transition-all">
      <i class="fas fa-clipboard-check text-lg" aria-hidden="true"></i>
      <span class="text-[10px] font-black mt-1">回饋單</span>
    </button>
  </nav>

  <!-- Toast -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-24 bg-indigo-900 text-white text-[12px] font-black px-4 py-2 rounded-full shadow-xl hidden z-[200]">
    已複製
  </div>

  <script>
    // ========= 正式連結（你提供的） =========
    const LINKS = {
      concept: "https://angel0973180707.github.io/angel-happy-paw/",
      form: "https://forms.gle/WRy6JLzrUbyj6hoD8",
      youtube: "https://youtu.be/p1WXzRhoUjg?si=qqEmL_dIDSnvxp45"
    };

    // ========= Helpers =========
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // ========= Pages =========
    const pages = ["home","dojo","video","repair","sos"];
    function showPage(pageId){
      if(!pages.includes(pageId)) return;

      $$(".page-content").forEach(p => p.classList.remove("active"));
      $("#page-"+pageId).classList.add("active");

      $$("#tab-home,#tab-dojo,#tab-video,#tab-repair").forEach(tab=>{
        tab.classList.remove("tab-active");
        tab.classList.add("text-indigo-300");
      });

      const activeTab = $("#tab-"+(pageId==="sos" ? "home" : pageId));
      if(activeTab){
        activeTab.classList.add("tab-active");
        activeTab.classList.remove("text-indigo-300");
      }

      if(pageId==="sos") startSOS();
      if(pageId==="video") ensureVideoLoaded();
      window.scrollTo({top:0, behavior:"smooth"});
    }

    // ========= Toast =========
    let toastTimer = null;
    function toast(msg="已複製"){
      const t = $("#toast");
      t.textContent = msg;
      t.classList.remove("hidden");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>t.classList.add("hidden"), 1200);
    }

    // ========= Copy =========
    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        toast("已複製");
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        toast("已複製");
      }
    }

    // ========= SOS =========
    let currentStep = 0;
    const steps = [
      "停——先停下追問，音量降到一半。",
      "看——看孩子的身體訊號，也掃描自己的拳頭與下巴有沒有越來越緊。",
      "呼——一起呼吸兩到三輪（吸4秒、停2秒、吐6秒）。",
      "名——幫情緒命名：「你看起來卡住又著急，肚子也緊緊的。」",
      "換——把任務切小：先只說「芒」，說完就擊掌。",
      "動——讓身體參一腳：手指嘴角，嘴巴張大，一起發「芒」。"
    ];

    function startSOS(){
      currentStep = 0;
      updateSOSUI();
    }

    function updateSOSUI(){
      const container = $("#sosSteps");
      container.innerHTML = "";
      for(let i=0; i<=currentStep; i++){
        const div = document.createElement("div");
        div.className = "p-4 bg-white rounded-2xl shadow-sm border-l-4 border-red-500 text-[13px] font-bold text-indigo-900 fade-in";
        div.innerHTML = `<span class="text-red-500 mr-2">${i+1}.</span> ${steps[i]}`;
        container.appendChild(div);
      }
      $("#sosBtn").innerText = currentStep === steps.length-1 ? "急救完成，找回連結" : "好，下一小步";
    }

    $("#sosBtn").addEventListener("click", ()=>{
      if(currentStep < steps.length-1){
        currentStep++;
        updateSOSUI();
      }else{
        showPage("home");
      }
    });

    // ========= Video embed =========
    function youtubeToEmbed(url){
      try{
        const u = new URL(url);
        let id = "";
        if(u.hostname.includes("youtu.be")){
          id = u.pathname.replace("/","").trim();
        }else{
          id = u.searchParams.get("v") || "";
        }
        return id ? `https://www.youtube.com/embed/${id}` : "";
      }catch(e){
        return "";
      }
    }

    let videoLoaded = false;
    function ensureVideoLoaded(){
      if(videoLoaded) return;
      const embed = youtubeToEmbed(LINKS.youtube);
      if(embed){
        $("#videoIframe").src = embed;
        videoLoaded = true;
      }
    }

    // ========= Buttons =========
    $("#btnWatchVideo").addEventListener("click", ()=> showPage("video"));
    $("#btnOpenConcept").addEventListener("click", ()=> window.open(LINKS.concept,"_blank"));
    $("#btnOpenConcept2").addEventListener("click", ()=> window.open(LINKS.concept,"_blank"));
    $("#btnOpenForm").addEventListener("click", ()=> window.open(LINKS.form,"_blank"));
    $("#btnOpenYoutube").addEventListener("click", ()=> window.open(LINKS.youtube,"_blank"));

    // ========= Treaty copy =========
    $("#btnCopyTreaty").addEventListener("click", ()=>{
      const t = [
        "芒果和平條約",
        "1) 我們不打人，也不打水果。",
        "2) 卡關時，我們先呼吸三次。",
        "3) 用選擇句：休息／抱抱／換回合。",
        "4) 完成一小步，就擊掌。"
      ].join("\n");
      copyText(t);
    });

    // ========= Event delegation =========
    document.addEventListener("click", (e)=>{
      const pageBtn = e.target.closest("[data-page]");
      if(pageBtn){
        showPage(pageBtn.getAttribute("data-page"));
        return;
      }

      const copyBtn = e.target.closest("[data-copy]");
      if(copyBtn){
        copyText(copyBtn.getAttribute("data-copy"));
        return;
      }
    });

    // Init
    showPage("home");
  </script>
</body>
</html>